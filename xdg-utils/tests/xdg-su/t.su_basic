#!/bin/bash

## Include utility functions.
. "$XDG_TEST_DIR/include/testassertions.sh"
. "$XDG_TEST_DIR/include/testcontrol.sh"

## Test function
test_su_basic() {
test_start "$FUNCTNAME: basic su - up-privilege"

test_init

## Require a running X server
require_notroot
require_interactive

assert_display

echo "root" >out.expected

test_procedure

assert_interactive "Please enter the admin password when prompted."

assert_exit 0 xdg-su -c 'whoami >out.who'
assert_nostdout
assert_nostderr

assert_file out.who out.expected

assert_interactive "Were you prompted for the admin password?" y

test_result
}

run_test test_su_basic
