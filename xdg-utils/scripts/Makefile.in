MKDIR      	= mkdir -p
RMDIR      	= rmdir
INSTALL         = @INSTALL@ $(INSTALL_FLAGS)
INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(INSTALL_PROGRAM_FLAGS)
INSTALL_LIBRARY = @INSTALL_PROGRAM@ $(INSTALL_PROGRAM_FLAGS)
INSTALL_SCRIPT  = @INSTALL_SCRIPT@ $(INSTALL_SCRIPT_FLAGS)
INSTALL_DATA    = @INSTALL_DATA@ $(INSTALL_DATA_FLAGS)
XMLTO           = @XMLTO@

prefix          = @prefix@
exec_prefix     = @exec_prefix@
bindir          = @bindir@
mandir          = @mandir@

SCRIPTS		= \
    xdg-menu \
    xdg-desktop \
    xdg-email \
    xdg-mime \
    xdg-su \
    xdg-open \
    xdg-copy \
    xdg-file-dialog \
    xdg-screensaver \
    xdg-icon

MANPAGES=	$(SCRIPTS:%=man/%.1)
WEBPAGES=	$(SCRIPTS:%=%.html)

all:		

html:		$(WEBPAGES)

scripts:	README $(SCRIPTS)

release:	scripts
	rm -f xdg-*.in *~ HACKING
	rm -rf desc/

distclean: clean
	rm -f Makefile

clean:

scripts-clean:
	rm -f $(SCRIPTS) README man/xdg-*.1 html/xdg-*.html

README: $(SCRIPTS)
	echo > $@
	@for x in $(SCRIPTS) ; do \
	    sh ./$$x --help | grep -B 100 Synopsis | sed -e '$$d' >> $@ ; \
	done

install: $(SCRIPTS) $(MANPAGES)
	$(MKDIR) $(bindir)
	for x in $(SCRIPTS) ; do \
	    $(INSTALL_SCRIPT) $$x $(bindir) ; \
	done
	$(MKDIR) $(mandir)
	$(MKDIR) $(mandir)/man1
	for x in $(MANPAGES) ; do \
	    $(INSTALL_DATA) $$x $(mandir)/man1 ; \
	done

uninstall:
	for x in $(MANPAGES) ; do \
	    rm -f $(mandir)/man1/`basename $$x` ; \
	done
	-$(RMDIR) $(mandir)/man1
	-$(RMDIR) $(mandir)
	for x in $(SCRIPTS) ; do \
	    rm -f $(bindir)/$$x ; \
	done
	-$(RMDIR) $(bindir)

%: %.in %.txt
	awk -f generate-help-script.awk $@.in > $@
	chmod a+x $@

xdg-menu: xdg-menu.in xdg-utils-common.in
xdg-desktop: xdg-desktop.in xdg-utils-common.in
xdg-email: xdg-email.in xdg-utils-common.in
xdg-mime: xdg-mime.in xdg-utils-common.in
xdg-su: xdg-su.in xdg-utils-common.in
xdg-open: xdg-open.in xdg-utils-common.in
xdg-copy: xdg-copy.in xdg-utils-common.in
xdg-file-dialog: xdg-file-dialog.in xdg-utils-common.in
xdg-screensaver: xdg-screensaver.in xdg-utils-common.in
xdg-icon: xdg-icon.in xdg-utils-common.in

man/%.1: desc/%.xml
	(cd man;$(XMLTO) man ../$<)

%.html: desc/%.xml
	(cd html;$(XMLTO) html-nochunks ../$<)

%.txt: desc/%.xml
	$(XMLTO) txt $<

